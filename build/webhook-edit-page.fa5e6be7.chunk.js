"use strict";(self.webpackChunkssa_reseller=self.webpackChunkssa_reseller||[]).push([[5162],{93016:(V,h,t)=>{t.d(h,{Z:()=>v});var e=t(53547),u=t(84714);function g(){return e.createElement(u.Z.Root,null,e.createElement(u.Z.Headers,null),e.createElement(u.Z.Body,null))}const v=g},84714:(V,h,t)=>{t.d(h,{Z:()=>Ee});var e=t(53547),u=t(50253),g=t(75878),v=t(4090),I=t(28809),j=t(23440),L=t(74880),O=t(43247),p=t(22996),Y=t(78549),ce=t(775),z=t(13539),J=t(62779),k=t(69554),q=t(45697),P=t.n(q),G=t(86896),ue=t(88972),D=t(39645);const ge=o=>o.reduce((i,l)=>{const M=l.split(".")[0];return i[M]||(i[M]=[]),i[M].push(l),i},{}),E=(0,ue.ZP)(u.w)`
  tbody tr:nth-child(odd) {
    background: ${({theme:o})=>o.colors.neutral100};
  }

  thead th span {
    color: ${({theme:o})=>o.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:o})=>o.spaces[3]};
    padding-block-end: ${({theme:o})=>o.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:o})=>o.spaces[2]};
  }
`,Z=o=>{const i=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return o&&(i.push({id:"app.utils.publish",defaultMessage:"Publish"}),i.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),i},me=o=>{const i=["entry.create","entry.update","entry.delete"];return o&&i.push("entry.publish","entry.unpublish"),{entry:i,media:["media.create","media.update","media.delete"]}},ee=e.createContext(),oe=({children:o})=>{const{formatMessage:i}=(0,G.Z)(),{collectionTypes:l,isLoading:M}=(0,D.G)(),C=e.useMemo(()=>l.some(S=>S.options.draftAndPublish===!0),[l]),W=i({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return e.createElement(ee.Provider,{value:{isDraftAndPublish:C}},e.createElement(g.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(v.Q,{"aria-hidden":!0},W),M&&e.createElement(I.a,null,i({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})),e.createElement(E,{"aria-label":W},o)))};oe.propTypes={children:P().oneOfType([P().arrayOf(P().node),P().node]).isRequired};const te=({getHeaders:o=Z})=>{const{isDraftAndPublish:i}=e.useContext(ee),{formatMessage:l}=(0,G.Z)(),M=o(i);return e.createElement(j.S,null,e.createElement(L.Z,null,e.createElement(O.g,null,e.createElement(p.T,null,l({id:"Settings.webhooks.event.select",defaultMessage:"Select event"}))),M.map(C=>["app.utils.publish","app.utils.unpublish"].includes(C.id)?e.createElement(O.g,{key:C.id,title:l({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"})},e.createElement(Y.Z,{variant:"sigma",textColor:"neutral600"},l(C))):e.createElement(O.g,{key:C.id},e.createElement(Y.Z,{variant:"sigma",textColor:"neutral600"},l(C))))))};te.defaultProps={getHeaders:Z},te.propTypes={getHeaders:P().func};const ne=({providedEvents:o})=>{const{isDraftAndPublish:i}=e.useContext(ee),l=o||me(i),{values:M,handleChange:C}=(0,k.u6)(),W="events",S=M.events,K=[],F=ge(S),w=({target:{name:b,value:d}})=>{let A=new Set(S);d?A.add(b):A.delete(b),C({target:{name:W,value:Array.from(A)}})},N=({target:{name:b,value:d}})=>{let A=new Set(S);d?l[b].forEach(Q=>{K.includes(Q)||A.add(Q)}):l[b].forEach(Q=>A.delete(Q)),C({target:{name:W,value:Array.from(A)}})};return e.createElement(ce.X,null,Object.entries(l).map(([b,d])=>e.createElement(x,{disabledEvents:K,key:b,name:b,events:d,inputValue:F[b],handleSelect:w,handleSelectAll:N})))};ne.defaultProps={providedEvents:null},ne.propTypes={providedEvents:P().object};const le=o=>o.replace(/-/g," ").split(" ").map(i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()).join(" "),x=({disabledEvents:o,name:i,events:l,inputValue:M,handleSelect:C,handleSelectAll:W})=>{const{formatMessage:S}=(0,G.Z)(),K=l.filter(d=>!o.includes(d)),F=M.length>0,w=M.length===K.length,N=({target:{name:d}})=>{W({target:{name:d,value:!w}})},b=5;return e.createElement(L.Z,null,e.createElement(O.f,null,e.createElement(z.X,{indeterminate:F&&!w,"aria-label":S({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:i,onChange:N,value:w},le(i))),l.map(d=>e.createElement(O.f,{key:d},e.createElement(J.C,{disabled:o.includes(d),"aria-label":d,name:d,value:M.includes(d),onValueChange:A=>C({target:{name:d,value:A}})}))),l.length<b&&e.createElement(O.f,{colSpan:`${b-l.length}`}))};x.defaultProps={disabledEvents:[],events:[],inputValue:[],handleSelect(){},handleSelectAll(){}},x.propTypes={disabledEvents:P().array,events:P().array,inputValue:P().array,handleSelect:P().func,handleSelectAll:P().func,name:P().string.isRequired};const Ee={Root:oe,Headers:te,Body:ne,EventRow:x}},41128:(V,h,t)=>{t.d(h,{Z:()=>Pe});var e=t(53547),u=t(57713),g=t(72178),v=t(88767),I=t(16550),j=t(39645),L=t(70885),O=t(79371),p=t(75878),Y=t(19442),ce=t(26789),z=t(50781),J=t(9370),k=t(61585),q=t(28469),P=t(85362),G=t(8675),ue=t(60793),D=t(69554),ge=t(45697),E=t.n(ge),Z=t(86896),me=t(4090),ee=t(90139),oe=t(12978),te=t(63122),ne=t(85612);const le=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],x=({name:n,onChange:a,value:s,...c})=>{const{values:{headers:f}}=(0,D.u6)(),[B,m]=(0,e.useState)(le);(0,e.useEffect)(()=>{m(le.filter(r=>!f?.some(H=>H.key!==s&&H.key===r)))},[f,s]);const $=r=>{a({target:{name:n,value:r}})},ae=r=>{m(H=>[...H,r]),$(r)};return e.createElement(te.XU,{...c,onClear:()=>$(""),onChange:$,onCreateOption:ae,placeholder:"",value:s},B.map(r=>e.createElement(ne.O,{value:r,key:r},r)))};x.defaultProps={value:void 0},x.propTypes={name:E().string.isRequired,onChange:E().func.isRequired,value:E().string};const Ee=x,i=()=>{const{formatMessage:n}=(0,Z.Z)(),{values:a,errors:s}=(0,D.u6)();return e.createElement(p.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(me.Q,null,n({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})),e.createElement(z.x,{padding:8,background:"neutral100",hasRadius:!0},e.createElement(D.F2,{validateOnChange:!1,name:"headers",render:({push:c,remove:f})=>e.createElement(J.r,{gap:4},a.headers.map((B,m)=>e.createElement(e.Fragment,{key:`${m}.${B.key}`},e.createElement(k.P,{col:6},e.createElement(D.gN,{as:Ee,name:`headers.${m}.key`,"aria-label":`row ${m+1} key`,label:n({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:s.headers?.[m]?.key&&s.headers[m].key})),e.createElement(k.P,{col:6},e.createElement(p.k,{alignItems:"flex-end"},e.createElement(z.x,{style:{flex:1}},e.createElement(D.gN,{as:q.o,name:`headers.${m}.value`,"aria-label":`row ${m+1} value`,label:n({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:s.headers?.[m]?.value&&s.headers[m].value})),e.createElement(p.k,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:s.headers?.[m]?.value?0:5},e.createElement(g.fG,{disabled:a.headers.length===1,onClick:()=>f(m),label:n({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:m+1})})))))),e.createElement(k.P,{col:12},e.createElement(ee.A,{type:"button",onClick:()=>{c({key:"",value:""})},startIcon:e.createElement(oe.Z,null)},n({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"}))))})))};var l=t(78549),M=t(64518),C=t(15800),W=t(88972);const S=W.ZP.svg(({theme:n,color:a})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;

  path {
    fill: ${n.colors[a]};
  }
`),K=({isPending:n,statusCode:a})=>{const{formatMessage:s}=(0,Z.Z)();return n?e.createElement(p.k,{gap:2,alignItems:"center"},e.createElement(S,{as:M.Z}),e.createElement(l.Z,null,s({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"}))):a>=200&&a<300?e.createElement(p.k,{gap:2,alignItems:"center"},e.createElement(S,{as:G.Z,color:"success700"}),e.createElement(l.Z,null,s({id:"Settings.webhooks.trigger.success",defaultMessage:"success"}))):a>=300?e.createElement(p.k,{gap:2,alignItems:"center"},e.createElement(S,{as:C.Z,color:"danger700"}),e.createElement(l.Z,null,s({id:"Settings.error",defaultMessage:"error"})," ",a)):null};K.propTypes={isPending:E().bool.isRequired,statusCode:E().number},K.defaultProps={statusCode:void 0};const F=({statusCode:n,message:a})=>{const{formatMessage:s}=(0,Z.Z)();return n>=200&&n<300?e.createElement(p.k,{justifyContent:"flex-end"},e.createElement(l.Z,{textColor:"neutral600",ellipsis:!0},s({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"}))):n>=300?e.createElement(p.k,{justifyContent:"flex-end"},e.createElement(p.k,{maxWidth:(0,g.Q1)(250),justifyContent:"flex-end",title:a},e.createElement(l.Z,{ellipsis:!0,textColor:"neutral600"},a))):null};F.propTypes={statusCode:E().number,message:E().string},F.defaultProps={statusCode:void 0,message:void 0};const w=({onCancel:n})=>{const{formatMessage:a}=(0,Z.Z)();return e.createElement(p.k,{justifyContent:"flex-end"},e.createElement("button",{onClick:n,type:"button"},e.createElement(p.k,{gap:2,alignItems:"center"},e.createElement(l.Z,{textColor:"neutral400"},a({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})),e.createElement(S,{as:C.Z,color:"neutral400"}))))};w.propTypes={onCancel:E().func.isRequired};const N=({isPending:n,onCancel:a,response:s})=>{const{statusCode:c,message:f}=s,{formatMessage:B}=(0,Z.Z)();return e.createElement(z.x,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0},e.createElement(J.r,{gap:4,style:{alignItems:"center"}},e.createElement(k.P,{col:3},e.createElement(l.Z,null,B({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"}))),e.createElement(k.P,{col:3},e.createElement(K,{isPending:n,statusCode:c})),e.createElement(k.P,{col:6},n?e.createElement(w,{onCancel:a}):e.createElement(F,{statusCode:c,message:f}))))};N.defaultProps={isPending:!1,onCancel(){},response:{}},N.propTypes={isPending:E().bool,onCancel:E().func,response:E().object};const b=N;var d=t(48040);const A=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,Q=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,Me=({formatMessage:n})=>d.Ry().shape({name:d.Z_().required(n({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(A,n({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:d.Z_().required(n({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(Q,n({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:d.Vo(a=>{let s=d.IX();if(a.length===1){const{key:c,value:f}=a[0];if(!c&&!f)return s}return s.of(d.Ry().shape({key:d.Z_().required(n({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:d.Z_().required(n({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:d.IX()});var Ce=function(){return window&&window.strapi&&window.strapi.isEE?t(65224).Z:t(93016).Z}(),he=function(a){var s,c,f=a.handleSubmit,B=a.triggerWebhook,m=a.isCreating,$=a.isTriggering,ae=a.triggerResponse,r=a.data,H=(0,Z.Z)(),U=H.formatMessage,se=(0,e.useState)(!1),ie=(0,L.Z)(se,2),ve=ie[0],de=ie[1],pe=function(X){return Object.keys(X).length?Object.entries(X).map(function(_){var y=(0,L.Z)(_,2),R=y[0],be=y[1];return{key:R,value:be}}):[{key:"",value:""}]},T=(0,D.TA)({initialValues:{name:r?.name||"",url:r?.url||"",headers:pe(r?.headers||{}),events:r?.events||[]},onSubmit:function(X,_){var y=_.resetForm,R=_.setSubmitting;f(X),y({values:X}),R(!1)},validationSchema:Me({formatMessage:U}),validateOnChange:!1,validateOnBlur:!1});return e.createElement(D.Hy,{value:T},e.createElement(g.l0,{onSubmit:T.handleSubmit},e.createElement(O.T,{primaryAction:e.createElement(p.k,{gap:2},e.createElement(Y.z,{onClick:function(){B(),de(!0)},variant:"tertiary",startIcon:e.createElement(P.Z,null),disabled:m||$,size:"L"},U({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})),e.createElement(Y.z,{startIcon:e.createElement(G.Z,null),type:"submit",size:"L",disabled:!T.dirty,loading:T.isSubmitting},U({id:"global.save",defaultMessage:"Save"}))),title:m?U({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):r?.name,navigationAction:e.createElement(g.rU,{startIcon:e.createElement(ue.Z,null),to:"/settings/webhooks"},U({id:"global.back",defaultMessage:"Back"}))}),e.createElement(ce.D,null,e.createElement(p.k,{direction:"column",alignItems:"stretch",gap:4},ve&&e.createElement(b,{isPending:$,response:ae,onCancel:function(){return de(!1)}}),e.createElement(z.x,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0},e.createElement(p.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(J.r,{gap:6},e.createElement(k.P,{col:6},e.createElement(D.gN,{as:q.o,name:"name",error:(T==null||(s=T.errors)===null||s===void 0?void 0:s.name)&&T.errors.name,label:U({id:"global.name",defaultMessage:"Name"}),required:!0})),e.createElement(k.P,{col:12},e.createElement(D.gN,{as:q.o,name:"url",error:(T==null||(c=T.errors)===null||c===void 0?void 0:c.url)&&T.errors.url,label:U({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0}))),e.createElement(i,null),e.createElement(Ce,null)))))))};he.propTypes={data:E().object,handleSubmit:E().func.isRequired,triggerWebhook:E().func.isRequired,isCreating:E().bool.isRequired,isTriggering:E().bool.isRequired,triggerResponse:E().object},he.defaultProps={data:void 0,triggerResponse:void 0};const ye=he,fe=n=>({...n,headers:n.headers.reduce((a,{key:s,value:c})=>(s!==""&&(a[s]=c),a),{})}),Pe=()=>{const{params:{id:n}}=(0,I.$B)("/settings/webhooks/:id"),a=n==="create",{replace:s}=(0,I.k6)(),c=(0,g.lm)(),{formatAPIError:f}=(0,g.So)(),B=(0,v.useQueryClient)(),{isLoading:m}=(0,j.G)(),{put:$,get:ae,post:r}=(0,g.kY)(),{isLoading:H,data:U,error:se}=(0,v.useQuery)(["webhooks",n],async()=>{const{data:{data:y}}=await ae(`/admin/webhooks/${n}`);return y},{enabled:!a});e.useEffect(()=>{se&&c({type:"warning",message:f(se)})},[se,c,f]);const{isLoading:ie,data:ve,isIdle:de,mutate:pe}=(0,v.useMutation)(()=>r(`/admin/webhooks/${n}/trigger`)),T=()=>pe(null,{onError(y){c({type:"warning",message:f(y)})}}),re=(0,v.useMutation)(y=>r("/admin/webhooks",y)),X=(0,v.useMutation)(({id:y,body:R})=>$(`/admin/webhooks/${y}`,R)),_=async y=>{if(a){re.mutate(fe(y),{onSuccess({data:R}){c({type:"success",message:{id:"Settings.webhooks.created"}}),s(`/settings/webhooks/${R.data.id}`)},onError(R){c({type:"warning",message:f(R)})}});return}X.mutate({id:n,body:fe(y)},{onSuccess(){B.invalidateQueries(["webhooks",n]),c({type:"success",message:{id:"notification.form.success.fields"}})},onError(R){c({type:"warning",message:f(R)})}})};return H||m?e.createElement(g.dO,null):e.createElement(u.o,null,e.createElement(g.SL,{name:"Webhooks"}),e.createElement(ye,{data:U,handleSubmit:_,triggerWebhook:T,isCreating:a,isTriggering:ie,isTriggerIdle:de,triggerResponse:ve?.data.data}))}},3672:(V,h,t)=>{t.r(h),t.d(h,{default:()=>L});var e=t(53547),u=t(72178),g=t(7694),v=t(99369),I=t(41128);const L=()=>{const O=(0,g.v9)(v._);return e.createElement(u.O4,{permissions:O.settings.webhooks.create},e.createElement(I.Z,null))}},42122:(V,h,t)=>{t.r(h),t.d(h,{default:()=>L});var e=t(53547),u=t(72178),g=t(7694),v=t(99369),I=t(41128);const L=()=>{const O=(0,g.v9)(v._);return e.createElement(u.O4,{permissions:O.settings.webhooks.update},e.createElement(I.Z,null))}},65224:(V,h,t)=>{t.d(h,{Z:()=>j});var e=t(53547),u=t(84714);const g={"review-workflows":["review-workflows.updateEntryStage"]},v=()=>[{id:"review-workflows.updateEntryStage",defaultMessage:"Stage Change"}];function I(){return e.createElement(u.Z.Root,null,e.createElement(u.Z.Headers,null),e.createElement(u.Z.Body,null),e.createElement(u.Z.Headers,{getHeaders:v}),e.createElement(u.Z.Body,{providedEvents:g}))}const j=I},85612:(V,h,t)=>{t.d(h,{O:()=>u});var e=t(63122);const u=e.Wx},60793:(V,h,t)=>{t.d(h,{Z:()=>g});var e=t(2790);const u=v=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...v,children:(0,e.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),g=u}}]);
