"use strict";(self.webpackChunkssa_reseller=self.webpackChunkssa_reseller||[]).push([[2812],{50935:(b,f,t)=>{t.d(f,{R:()=>p});var e=t(72178),s=t(36232),L=t(88767);function p(E={},h={}){const{id:d="",...M}=E,v=(0,s.stringify)(M,{encode:!1}),{get:D}=(0,e.kY)(),{data:g,isError:O,isLoading:T,refetch:A}=(0,L.useQuery)(["users",d,M],async()=>{const{data:{data:R}}=await D(`/admin/users/${d}${v?`?${v}`:""}`);return R},h);let C=[];return d&&g?C=[g]:Array.isArray(g?.results)&&(C=g.results),{users:C,pagination:g?.pagination??null,isLoading:T,isError:O,refetch:A}}},94699:(b,f,t)=>{t.d(f,{Z:()=>D});var e=t(53547),s=t(50781),L=t(19442),p=t(72178),E=t(36002),h=t(45697),d=t.n(h),M=t(86896);const v=({displayedFilters:g})=>{const[O,T]=(0,e.useState)(!1),{formatMessage:A}=(0,M.Z)(),C=(0,e.useRef)(),R=()=>{T(Z=>!Z)};return e.createElement(e.Fragment,null,e.createElement(s.x,{paddingTop:1,paddingBottom:1},e.createElement(L.z,{variant:"tertiary",ref:C,startIcon:e.createElement(E.Z,null),onClick:R,size:"S"},A({id:"app.utils.filters",defaultMessage:"Filters"})),O&&e.createElement(p.J5,{displayedFilters:g,isVisible:O,onToggle:R,source:C})),e.createElement(p.W$,{filtersSchema:g}))};v.propTypes={displayedFilters:d().arrayOf(d().shape({name:d().string.isRequired,metadatas:d().shape({label:d().string}),fieldSchema:d().shape({type:d().string})})).isRequired};const D=v},35915:(b,f,t)=>{t.r(f),t.d(f,{default:()=>he});var e=t(53547),s=t(72178),L=t(7694),p=t(99369),E=t(45349),h=t(26789),d=t(50781),M=t(57713),v=t(79371),D=t(15483),g=t(86896),O=t(94699),T=t(88767),A=t(16550),C=t(50935);const Z=({canReadAuditLogs:a,canReadUsers:m})=>{const{get:c}=(0,s.kY)(),{search:i}=(0,A.TH)(),u=(0,s.lm)(),r={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:B=>u({type:"warning",message:B.message})},{users:n,isError:l,isLoading:y}=(0,C.R)({},{...r,enabled:m,staleTime:2*(1e3*60)}),{data:P,isLoading:U,isError:W}=(0,T.useQuery)(["auditLogs",i],async({queryKey:B})=>{const S=B[1],{data:ve}=await c(`/admin/audit-logs${S}`);return ve},{...r,enabled:a});return{auditLogs:P,users:n,isLoading:y||U,hasError:W||l}};var w=t(60881),k=t(18189),q=t(48683),_=t(63321),ee=t(36773),te=t(45697),o=t.n(te),ae=t(23855);const H=()=>{const{formatDate:a}=(0,g.Z)();return c=>{const i=(0,ae.Z)(c),u=a(i,{dateStyle:"long"}),r=a(i,{timeStyle:"medium",hourCycle:"h24"});return`${u}, ${r}`}};var x=t(75878),se=t(28809),I=t(78549),ne=t(9370),oe=t(17686);const z={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},$=a=>z[a]||a,Q=({actionLabel:a,actionName:m})=>e.createElement(x.k,{direction:"column",alignItems:"baseline",gap:1},e.createElement(I.Z,{textColor:"neutral600",variant:"sigma"},a),e.createElement(I.Z,{textColor:"neutral600"},m));Q.propTypes={actionLabel:o().string.isRequired,actionName:o().string.isRequired};const F=Q,K=({status:a,data:m,formattedDate:c})=>{const{formatMessage:i}=(0,g.Z)();if(a==="loading")return e.createElement(x.k,{padding:7,justifyContent:"center",alignItems:"center"},e.createElement(se.a,null,"Loading content..."));const{action:u,user:r,payload:n}=m;return e.createElement(e.Fragment,null,e.createElement(d.x,{marginBottom:3},e.createElement(I.Z,{variant:"delta",id:"title"},i({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"}))),e.createElement(ne.r,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0},e.createElement(F,{actionLabel:i({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:i({id:`Settings.permissions.auditLogs.${u}`,defaultMessage:$(u)},{model:n?.model})}),e.createElement(F,{actionLabel:i({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:c}),e.createElement(F,{actionLabel:i({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:r?.displayName||"-"}),e.createElement(F,{actionLabel:i({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:r?.id.toString()||"-"})),e.createElement(oe.V,{value:JSON.stringify(n,null,2),disabled:!0,label:i({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})}))};K.defaultProps={data:{}},K.propTypes={status:o().oneOf(["idle","loading","error","success"]).isRequired,data:o().shape({action:o().string,date:o().string,payload:o().object,user:o().object}),formattedDate:o().string.isRequired};const ie=K,Y=({handleClose:a,logId:m})=>{const{get:c}=(0,s.kY)(),i=(0,s.lm)(),u=async P=>{const{data:U}=await c(`/admin/audit-logs/${P}`);if(!U)throw new Error("Audit log not found");return U},{data:r,status:n}=(0,T.useQuery)(["audit-log",m],()=>u(m),{onError(){i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),a()}}),l=H(),y=r?l(r.date):"";return e.createElement(w.P,{onClose:a,labelledBy:"title"},e.createElement(k.x,null,e.createElement(_.O,{label:y,id:"title"},e.createElement(ee.$,{isCurrent:!0},y))),e.createElement(q.f,null,e.createElement(ie,{status:n,data:r,formattedDate:y})))};Y.propTypes={handleClose:o().func.isRequired,logId:o().string.isRequired};const re=Y,j=({pagination:a})=>e.createElement(d.x,{paddingTop:4},e.createElement(x.k,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(s.v4,null),e.createElement(s.tU,{pagination:a})));j.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},j.propTypes={pagination:o().shape({page:o().number,pageCount:o().number,pageSize:o().number,total:o().number})};const le=j;var de=t(94487),me=t(6090),J=t(62351),ue=t(37527),ce=t(2953);const N=({headers:a,rows:m,onOpenModal:c})=>{const{formatMessage:i}=(0,g.Z)(),u=H(),r=({type:n,value:l,model:y})=>n==="date"?u(l):n==="action"?i({id:`Settings.permissions.auditLogs.${l}`,defaultMessage:$(l)},{model:y}):l||"-";return e.createElement(de.p,null,m.map(n=>e.createElement(me.Tr,{key:n.id,...(0,s.X7)({fn:()=>c(n.id)})},a.map(({key:l,name:y,cellFormatter:P})=>e.createElement(J.Td,{key:l},e.createElement(I.Z,{textColor:"neutral800"},r({type:l,value:P?P(n[y]):n[y],model:n.payload?.model})))),e.createElement(J.Td,{...s.UW},e.createElement(x.k,{justifyContent:"end"},e.createElement(ue.h,{onClick:()=>c(n.id),"aria-label":i({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${n.action} action`}),noBorder:!0,icon:e.createElement(ce.Z,null)}))))))};N.defaultProps={rows:[]},N.propTypes={headers:o().array.isRequired,rows:o().array,onOpenModal:o().func.isRequired};const ge=N;var pe=t(63122),Ee=t(85612);const V=({value:a,options:m,onChange:c})=>{const{formatMessage:i}=(0,g.Z)(),u=i({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return e.createElement(pe.hQ,{"aria-label":u,value:a,onChange:c},m.map(({label:r,customValue:n})=>e.createElement(Ee.O,{key:n,value:n},r)))};V.defaultProps={value:null},V.propTypes={value:o().string,options:o().arrayOf(o().shape({label:o().string.isRequired,customValue:o().string.isRequired}).isRequired).isRequired,onChange:o().func.isRequired};const X=V,G=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],fe=({formatMessage:a,users:m,canReadUsers:c})=>{const i=Object.keys(z).map(r=>({label:a({id:`Settings.permissions.auditLogs.${r}`,defaultMessage:$(r)},{model:void 0}),customValue:r})),u=[{name:"action",metadatas:{customOperators:G,label:a({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),options:i,customInput:X},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:a({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(c&&m){const r=l=>l.username?l.username:l.firstname&&l.lastname?a({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:l.firstname,lastname:l.lastname}):l.email,n=m.map(l=>({label:r(l),customValue:l.id.toString()}));return[...u,{name:"user",metadatas:{customOperators:G,label:a({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:n,customInput:X},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return u},ye=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:a=>a?a.displayName:""}],Le=()=>{const{formatMessage:a}=(0,g.Z)(),m=(0,L.v9)(p._),{allowedActions:{canRead:c,canReadUsers:i}}=(0,s.ss)({...m.settings.auditLogs,readUsers:m.settings.users.read}),[{query:u},r]=(0,s.Kx)(),{auditLogs:n,users:l,isLoading:y,hasError:P}=Z({canReadAuditLogs:c,canReadUsers:i});(0,s.go)();const U=fe({formatMessage:a,users:l,canReadUsers:i}),W=a({id:"global.auditLogs",defaultMessage:"Audit Logs"}),B=ye.map(S=>({...S,metadatas:{...S.metadatas,label:a(S.metadatas.label)}}));return P?e.createElement(E.A,null,e.createElement(h.D,null,e.createElement(d.x,{paddingTop:8},e.createElement(s.Hn,null)))):e.createElement(M.o,{"aria-busy":y},e.createElement(s.SL,{name:W}),e.createElement(v.T,{title:W,subtitle:a({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),e.createElement(D.Z,{startActions:e.createElement(O.Z,{displayedFilters:U})}),e.createElement(h.D,{canRead:c},e.createElement(s.tM,{contentType:"Audit logs",headers:B,rows:n?.results||[],withBulkActions:!0,isLoading:y},e.createElement(ge,{headers:B,rows:n?.results||[],onOpenModal:S=>r({id:S})})),e.createElement(le,{pagination:n?.pagination})),u?.id&&e.createElement(re,{handleClose:()=>r({id:null},"remove"),logId:u.id}))},he=()=>{const a=(0,L.v9)(p._);return e.createElement(s.O4,{permissions:a.settings.auditLogs.main},e.createElement(Le,null))}},85612:(b,f,t)=>{t.d(f,{O:()=>s});var e=t(63122);const s=e.Wx},15483:(b,f,t)=>{t.d(f,{Z:()=>L});var e=t(2790),s=t(75878);const L=({startActions:p,endActions:E})=>!p&&!E?null:(0,e.jsxs)(s.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(s.k,{gap:2,wrap:"wrap",children:p}),(0,e.jsx)(s.k,{gap:2,shrink:0,wrap:"wrap",children:E})]})},63321:(b,f,t)=>{t.d(f,{O:()=>v});var e=t(53547),s=t(45697),L=t(88972),p=t(41580),E=t(75515);const h=()=>e.createElement(p.x,{"aria-hidden":!0,paddingLeft:1,paddingRight:1},e.createElement(E.Z,{variant:"pi",textColor:"neutral500"},"/"));h.displayName="Divider";var d=t(11047);const M=(0,L.ZP)(d.k)`
  // CrumbLinks do have padding-x, because they need to have a
  // interaction effect, which mis-aligns the breadcrumbs on the left.
  // This normalizes the behavior by moving the first item to left by
  // the same amount it has inner padding
  :first-child {
    margin-left: ${({theme:D})=>`calc(-1*${D.spaces[2]})`};
  }
`,v=({label:D,children:g,...O})=>{const T=e.Children.toArray(g);return e.createElement(p.x,{"aria-label":D,...O},e.createElement(M,{as:"ol",horizontal:!0},e.Children.map(T,(A,C)=>{const R=T.length>1&&C+1<T.length;return e.createElement(d.k,{inline:!0,as:"li"},A,R&&e.createElement(h,null))})))};v.displayName="Breadcrumbs",v.propTypes={children:s.oneOfType([s.arrayOf(s.node),s.node]).isRequired,label:s.string.isRequired}},36773:(b,f,t)=>{t.d(f,{$:()=>E});var e=t(53547),s=t(45697),L=t(41580),p=t(75515);const E=({children:h,isCurrent:d,...M})=>e.createElement(L.x,{paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1},e.createElement(p.Z,{variant:"pi",textColor:"neutral800",fontWeight:d?"bold":"normal","aria-current":d,...M},h));E.displayName="Crumb",E.defaultProps={isCurrent:!1},E.propTypes={children:s.node.isRequired,isCurrent:s.bool}}}]);
